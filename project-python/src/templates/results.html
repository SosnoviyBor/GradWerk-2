{% extends "base.html" %}

{% block title %}
Simuation results
{% endblock title %}

{% block static %}
<!-- Bootstrap CSS/JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<!-- Chart.js for charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<!-- Local JS/CSS -->
<script src="{{ url_for('static', path='results/main.js') }}" type="module"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', path='results/results.css') }}" />
{% endblock static %}

{% block header %}
<h1 id="results-heading">Simulation Results</h1>
{% endblock header %}

{% block wrapper %}
<!-- Charts Section -->
<div id="charts" class="centered">
  <!-- Failure Probability Chart -->
  <div class="chart-card">
    <div class="chart-div">
      <canvas class="chart" id="chart-failprob"></canvas>
    </div>
  </div>
  <!-- Failures Chart -->
  <div class="chart-card">
    <div class="chart-div">
      <canvas class="chart" id="chart-fails"></canvas>
    </div>
  </div>
  <!-- Mean Queue Chart -->
  <div class="chart-card">
    <div class="chart-div">
      <canvas class="chart" id="chart-meanqueue"></canvas>
    </div>
  </div>
  <!-- Quantity Chart -->
  <div class="chart-card">
    <div class="chart-div">
      <canvas class="chart" id="chart-quantity"></canvas>
    </div>
  </div>
</div>

<!-- Computation Statistics -->
<div id="system-usage-logbox" class="system-usage-outer mb-4">
  <div class="system-usage-heading">- Computation Statistics -</div>
  <div class="resourcebox">
    <div class="resource-table-card">
      <table class="resource-table">
        <tbody>
          <tr>
            <td class="resource-label"><strong>Mean RAM Usage:</strong></td>
            <td class="resource-value">{{ mem_mean }} MB</td>
          </tr>
          <tr>
            <td class="resource-label"><strong>Peak RAM Usage:</strong></td>
            <td class="resource-value">{{ mem_peak }} MB</td>
          </tr>
          <tr>
            <td class="resource-label"><strong>Total CPU Time:</strong></td>
            <td class="resource-value">{{ total_time }} seconds</td>
          </tr>
          <tr>
            <td class="resource-label"><strong>Sim CPU Time:</strong></td>
            <td class="resource-value">{{ sim_time }} seconds</td>
          </tr>
          <tr>
            <td class="resource-label"><strong>Total events:</strong></td>
            <td class="resource-value">{{ iterations }}</td>
          </tr>
          <tr>
            <td class="resource-label"><strong>Events/second:</strong></td>
            <td class="resource-value">{{ iters_per_sec }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Logs Section -->
<div id="logs">
  <!-- Simulation Start Log -->
  <div id="logs-first" class="logbox-outer">
    <div class="logbox-heading">- Simulation Start Log -</div>
    <div class="logbox">
      {% for message in log.first %}
      {% for line in message %}
      {% if line == "" %}
      <br>
      {% else %}
      <div class="log-line">{{line}}</div>
      {% endif %}
      {% endfor %}
      {% endfor %}
    </div>
  </div>
  <!-- Simulation End Log -->
  <div id="logs-last" class="logbox-outer">
    <div class="logbox-heading">- Simulation End Log -</div>
    <div class="logbox">
      {% for message in log.last %}
      {% for line in message %}
      {% if line == "" %}
      <br>
      {% else %}
      <div class="log-line">{{line}}</div>
      {% endif %}
      {% endfor %}
      {% endfor %}
    </div>
  </div>
</div>

<!-- Hidden Elements Data Section -->
<div id="elements" hidden>
  {% for element in results %}
  <div class="element" id="{{ 'element-' ~ element.data.id }}" data-name="{{ element.data.name }}"
    data-mean="{{ element.data.mean }}" data-deviation="{{ element.data.deviation }}"
    data-worker-count="{{ element.data.worker_count }}" data-distribution="{{ element.data.distribution }}"
    data-max-queue="{{ element.data.max_queue }}" data-quantity="{{ element.result.quantity }}"
    data-failures="{{ element.result.failures }}" data-mean-queue-length="{{ element.result.mean_queue_length }}"
    data-failure-probability="{{ element.result.failure_probability }}">
  </div>
  {% endfor %}
</div>
{% endblock wrapper %}